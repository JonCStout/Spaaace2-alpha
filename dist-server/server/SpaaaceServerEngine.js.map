{"version":3,"sources":["../../src/server/SpaaaceServerEngine.js"],"names":["nameGenerator","require","NUM_BOTS","NUM_POWERUPS","SpaaaceServerEngine","io","gameEngine","inputOptions","scoreData","x","makeBot","i","makeShotLengthPowerUp","on","e","missile","ownerId","kills","ship","id","updateScore","console","log","toString","removeObjectFromWorld","isBot","setTimeout","socket","makePlayerShip","makeShip","playerId","name","socketId","playerObjects","world","queryObjects","forEach","obj","bot","attachAI","sockets","emit","ServerEngine"],"mappings":";;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AACA,IAAMA,aAAa,GAAGC,OAAO,CAAC,iBAAD,CAA7B;;AAEA,IAAMC,QAAQ,GAAG,EAAjB;AACA,IAAMC,YAAY,GAAG,EAArB;;IAEqBC,mB;;;;;AAEjB,+BAAYC,EAAZ,EAAgBC,UAAhB,EAA4BC,YAA5B,EAA0C;AAAA;;AAAA;;AACtC,6FAAMF,EAAN,EAAUC,UAAV,EAAsBC,YAAtB;AACA,UAAKC,SAAL,GAAiB,EAAjB;AAFsC;AAGzC,G,CAED;AACA;;;;;4BACQ;AAAA;;AACJ;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,QAApB,EAA8BO,CAAC,EAA/B;AAAmC,aAAKC,OAAL;AAAnC;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,YAApB,EAAkCQ,CAAC,EAAnC;AAAwC,aAAKL,UAAL,CAAgBM,qBAAhB;AAAxC;;AAEA,WAAKN,UAAL,CAAgBO,EAAhB,CAAmB,YAAnB,EAAiC,UAAAC,CAAC,EAAI;AAElC;AACA,YAAI,MAAI,CAACN,SAAL,CAAeM,CAAC,CAACC,OAAF,CAAUC,OAAzB,CAAJ,EAAuC,MAAI,CAACR,SAAL,CAAeM,CAAC,CAACC,OAAF,CAAUC,OAAzB,EAAkCC,KAAlC,GAHL,CAKlC;;AACA,eAAO,MAAI,CAACT,SAAL,CAAeM,CAAC,CAACI,IAAF,CAAOC,EAAtB,CAAP;;AACA,QAAA,MAAI,CAACC,WAAL;;AAEAC,QAAAA,OAAO,CAACC,GAAR,wBAA4BR,CAAC,CAACI,IAAF,CAAOK,QAAP,EAA5B;;AACA,QAAA,MAAI,CAACjB,UAAL,CAAgBkB,qBAAhB,CAAsCV,CAAC,CAACI,IAAF,CAAOC,EAA7C;;AACA,YAAIL,CAAC,CAACI,IAAF,CAAOO,KAAX,EAAkB;AACdC,UAAAA,UAAU,CAAC;AAAA,mBAAM,MAAI,CAAChB,OAAL,EAAN;AAAA,WAAD,EAAuB,IAAvB,CAAV;AACH;AACJ,OAdD;AAeH,K,CAED;;;;sCACkBiB,M,EAAQ;AAAA;;AACtB,iGAAwBA,MAAxB;;AAEA,UAAIC,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AACvB,YAAIV,IAAI,GAAG,MAAI,CAACZ,UAAL,CAAgBuB,QAAhB,CAAyBF,MAAM,CAACG,QAAhC,CAAX;;AAEA,QAAA,MAAI,CAACtB,SAAL,CAAeU,IAAI,CAACC,EAApB,IAA0B;AACtBF,UAAAA,KAAK,EAAE,CADe;AAEtBc,UAAAA,IAAI,EAAE/B,aAAa,CAAC,SAAD;AAFG,SAA1B;;AAIA,QAAA,MAAI,CAACoB,WAAL;AACH,OARD,CAHsB,CAatB;;;AACAO,MAAAA,MAAM,CAACd,EAAP,CAAU,gBAAV,EAA4Be,cAA5B;AACH,K,CAED;;;;yCACqBI,Q,EAAUF,Q,EAAU;AAAA;;AACrC,oGAA2BE,QAA3B,EAAqCF,QAArC,EADqC,CAIrC;;;AACA,UAAIG,aAAa,GAAG,KAAK3B,UAAL,CAAgB4B,KAAhB,CAAsBC,YAAtB,CAAmC;AAAEL,QAAAA,QAAQ,EAAEA;AAAZ,OAAnC,CAApB;AACAG,MAAAA,aAAa,CAACG,OAAd,CAAuB,UAAAC,GAAG,EAAI;AAC1B,QAAA,MAAI,CAAC/B,UAAL,CAAgBkB,qBAAhB,CAAsCa,GAAG,CAAClB,EAA1C,EAD0B,CAE1B;;;AACA,eAAO,MAAI,CAACX,SAAL,CAAe6B,GAAG,CAAClB,EAAnB,CAAP;AACH,OAJD;AAMA,WAAKC,WAAL;AACH,K,CAED;;;;8BACU;AACN,UAAIkB,GAAG,GAAG,KAAKhC,UAAL,CAAgBuB,QAAhB,CAAyB,CAAzB,CAAV;AACAS,MAAAA,GAAG,CAACC,QAAJ;AAEA,WAAK/B,SAAL,CAAe8B,GAAG,CAACnB,EAAnB,IAAyB;AACrBF,QAAAA,KAAK,EAAE,CADc;AAErBc,QAAAA,IAAI,EAAE/B,aAAa,CAAC,SAAD,CAAb,GAA2B;AAFZ,OAAzB;AAKA,WAAKoB,WAAL;AACH;;;kCAEa;AAAA;;AACV;AACAM,MAAAA,UAAU,CAAC,YAAM;AACb,QAAA,MAAI,CAACrB,EAAL,CAAQmC,OAAR,CAAgBC,IAAhB,CAAqB,aAArB,EAAoC,MAAI,CAACjC,SAAzC;AACH,OAFS,EAEP,IAFO,CAAV;AAIH;;;;EArF4CkC,qB","sourcesContent":["import { ServerEngine } from 'lance-gg';\r\nconst nameGenerator = require('./NameGenerator');\r\n\r\nconst NUM_BOTS = 10;\r\nconst NUM_POWERUPS = 10;\r\n\r\nexport default class SpaaaceServerEngine extends ServerEngine {\r\n\r\n    constructor(io, gameEngine, inputOptions) {\r\n        super(io, gameEngine, inputOptions);\r\n        this.scoreData = {};\r\n    }\r\n\r\n    // when the game starts, create robot spaceships, and register\r\n    // on missile-hit events\r\n    start() {\r\n        super.start();\r\n\r\n        for (let x = 0; x < NUM_BOTS; x++) this.makeBot();\r\n        for (let i = 0; i < NUM_POWERUPS; i++)  this.gameEngine.makeShotLengthPowerUp();\r\n\r\n        this.gameEngine.on('missileHit', e => {\r\n\r\n            // add kills\r\n            if (this.scoreData[e.missile.ownerId]) this.scoreData[e.missile.ownerId].kills++;\r\n\r\n            // remove score data for killed ship\r\n            delete this.scoreData[e.ship.id];\r\n            this.updateScore();\r\n\r\n            console.log(`ship killed: ${e.ship.toString()}`);\r\n            this.gameEngine.removeObjectFromWorld(e.ship.id);\r\n            if (e.ship.isBot) {\r\n                setTimeout(() => this.makeBot(), 5000);\r\n            }\r\n        });\r\n    }\r\n\r\n    // a player has connected\r\n    onPlayerConnected(socket) {\r\n        super.onPlayerConnected(socket);\r\n\r\n        let makePlayerShip = () => {\r\n            let ship = this.gameEngine.makeShip(socket.playerId);\r\n\r\n            this.scoreData[ship.id] = {\r\n                kills: 0,\r\n                name: nameGenerator('general')\r\n            };\r\n            this.updateScore();\r\n        };\r\n\r\n        // handle client restart requests\r\n        socket.on('requestRestart', makePlayerShip);\r\n    }\r\n\r\n    // a player has disconnected\r\n    onPlayerDisconnected(socketId, playerId) {\r\n        super.onPlayerDisconnected(socketId, playerId);\r\n\r\n\r\n        // iterate through all objects, delete those that are associated with the player (ship and missiles)\r\n        let playerObjects = this.gameEngine.world.queryObjects({ playerId: playerId });\r\n        playerObjects.forEach( obj => {\r\n            this.gameEngine.removeObjectFromWorld(obj.id);\r\n            // remove score associated with this ship\r\n            delete this.scoreData[obj.id];\r\n        });\r\n\r\n        this.updateScore();\r\n    }\r\n\r\n    // create a robot spaceship\r\n    makeBot() {\r\n        let bot = this.gameEngine.makeShip(0);\r\n        bot.attachAI();\r\n\r\n        this.scoreData[bot.id] = {\r\n            kills: 0,\r\n            name: nameGenerator('general') + 'Bot'\r\n        };\r\n\r\n        this.updateScore();\r\n    }\r\n\r\n    updateScore() {\r\n        // delay so player socket can catch up\r\n        setTimeout(() => {\r\n            this.io.sockets.emit('scoreUpdate', this.scoreData);\r\n        }, 1000);\r\n\r\n    }\r\n}\r\n"],"file":"SpaaaceServerEngine.js"}