{"version":3,"sources":["../../src/server/SpaaaceServerEngine.js"],"names":["nameGenerator","require","NUM_BOTS","NUM_POWERUPS","SpaaaceServerEngine","io","gameEngine","inputOptions","scoreData","x","makeBot","i","makeShotLengthPowerUp","on","e","missile","ownerId","kills","ship","id","updateScore","console","log","toString","removeObjectFromWorld","isBot","setTimeout","socket","makePlayerShip","makeShip","playerId","name","socketId","playerObjects","world","queryObjects","forEach","obj","bot","attachAI","sockets","emit","ServerEngine"],"mappings":"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","sourcesContent":["import { ServerEngine } from 'lance-gg';\nconst nameGenerator = require('./NameGenerator');\n\nconst NUM_BOTS = 3;\nconst NUM_POWERUPS = 10;\n\nexport default class SpaaaceServerEngine extends ServerEngine {\n\n    constructor(io, gameEngine, inputOptions) {\n        super(io, gameEngine, inputOptions);\n        this.scoreData = {};\n    }\n\n    // when the game starts, create robot spaceships, and register\n    // on missile-hit events\n    start() {\n        super.start();\n\n        for (let x = 0; x < NUM_BOTS; x++) this.makeBot();\n        for (let i = 0; i < NUM_POWERUPS; i++)  this.gameEngine.makeShotLengthPowerUp();\n\n        this.gameEngine.on('missileHit', e => {\n\n            // add kills\n            if (this.scoreData[e.missile.ownerId]) this.scoreData[e.missile.ownerId].kills++;\n\n            // remove score data for killed ship\n            delete this.scoreData[e.ship.id];\n            this.updateScore();\n\n            console.log(`ship killed: ${e.ship.toString()}`);\n            this.gameEngine.removeObjectFromWorld(e.ship.id);\n            if (e.ship.isBot) {\n                setTimeout(() => this.makeBot(), 5000);\n            }\n        });\n    }\n\n    // a player has connected\n    onPlayerConnected(socket) {\n        super.onPlayerConnected(socket);\n\n        let makePlayerShip = () => {\n            let ship = this.gameEngine.makeShip(socket.playerId);\n\n            this.scoreData[ship.id] = {\n                kills: 0,\n                name: nameGenerator('general')\n            };\n            this.updateScore();\n        };\n\n        // handle client restart requests\n        socket.on('requestRestart', makePlayerShip);\n    }\n\n    // a player has disconnected\n    onPlayerDisconnected(socketId, playerId) {\n        super.onPlayerDisconnected(socketId, playerId);\n\n\n        // iterate through all objects, delete those that are associated with the player (ship and missiles)\n        let playerObjects = this.gameEngine.world.queryObjects({ playerId: playerId });\n        playerObjects.forEach( obj => {\n            this.gameEngine.removeObjectFromWorld(obj.id);\n            // remove score associated with this ship\n            delete this.scoreData[obj.id];\n        });\n\n        this.updateScore();\n    }\n\n    // create a robot spaceship\n    makeBot() {\n        let bot = this.gameEngine.makeShip(0);\n        bot.attachAI();\n\n        this.scoreData[bot.id] = {\n            kills: 0,\n            name: nameGenerator('general') + 'Bot'\n        };\n\n        this.updateScore();\n    }\n\n    updateScore() {\n        // delay so player socket can catch up\n        setTimeout(() => {\n            this.io.sockets.emit('scoreUpdate', this.scoreData);\n        }, 1000);\n\n    }\n}\n"],"file":"SpaaaceServerEngine.js"}